# ================== IMPORT TH∆Ø VI·ªÜN ==================
from ucimlrepo import fetch_ucirepo
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import classification_report, accuracy_score, confusion_matrix, ConfusionMatrixDisplay

# fetch dataset 
online_shoppers_purchasing_intention_dataset = fetch_ucirepo(id=468) 
  
# data (as pandas dataframes) 
X = online_shoppers_purchasing_intention_dataset.data.features 
y = online_shoppers_purchasing_intention_dataset.data.targets 


# üëâ G·ªôp X v√† y l·∫°i chung 1 b·∫£ng
data = pd.concat([X, y], axis=1)

# Hi·ªÉn th·ªã 5 d√≤ng ƒë·∫ßu ti√™n
from IPython.display import display
display(data.head())
# Bi·ªÉu di·ªÖn d·ªØ li·ªáu c∆° b·∫£n
plt.figure(figsize=(6,4))
plt.scatter(X.iloc[:,0], X.iloc[:,1])
plt.xlabel("Sepal Length")
plt.ylabel("Sepal Width")
plt.title("Bi·ªÉu di·ªÖn d·ªØ li·ªáu Iris (Sepal Length vs Width)")
plt.show()

# ================== M√É H√ìA BI·∫æN PH√ÇN LO·∫†I ==================
# Bi·∫øn ƒë·ªïi c√°c c·ªôt d·∫°ng ch·ªØ th√†nh s·ªë (One-Hot Encoding)
X = pd.get_dummies(X, drop_first=True)



# ================== CHIA D·ªÆ LI·ªÜU TRAIN - TEST ==================
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)

# Chuy·ªÉn y v·ªÅ d·∫°ng vector 1D
y_train = y_train.values.ravel()
y_test = y_test.values.ravel()

# ================== CHU·∫®N H√ìA D·ªÆ LI·ªÜU ==================
scaler = StandardScaler()
X_train = scaler.fit_transform(X_train)
X_test = scaler.transform(X_test)

# ================== M√î H√åNH SVM ==================
from sklearn.svm import SVC
# Hu·∫•n luy·ªán SVM
svm = SVC(kernel='rbf')
svm.fit(X_train, y_train)
# D·ª± ƒëo√°n
y_pred_svm = svm.predict(X_test)
# ƒê√°nh gi√° k·∫øt qu·∫£
print("\n=== K·∫æT QU·∫¢ M√î H√åNH SVM ===")
print("Accuracy:", accuracy_score(y_test, y_pred_svm))
print(classification_report(y_test, y_pred_svm))
# Ma tr·∫≠n nh·∫ßm l·∫´n
cm_svm = confusion_matrix(y_test, y_pred_svm)
ConfusionMatrixDisplay(cm_svm).plot()
plt.title("Confusion Matrix - SVM")
plt.show()

# ================== M√î H√åNH KNN ==================
from sklearn.neighbors import KNeighborsClassifier
# Hu·∫•n luy·ªán KNN
knn = KNeighborsClassifier(n_neighbors=5)
knn.fit(X_train, y_train)
# D·ª± ƒëo√°n
y_pred_knn = knn.predict(X_test)
# ƒê√°nh gi√° k·∫øt qu·∫£
print("\n=== K·∫æT QU·∫¢ M√î H√åNH KNN ===")
print("Accuracy:", accuracy_score(y_test, y_pred_knn))
print(classification_report(y_test, y_pred_knn))
# Ma tr·∫≠n nh·∫ßm l·∫´n
cm_knn = confusion_matrix(y_test, y_pred_knn)
ConfusionMatrixDisplay(cm_knn).plot()
plt.title("Confusion Matrix - KNN")
plt.show()

# ================== TINH CH·ªàNH SVM (T√ôY CH·ªåN) ==================
from sklearn.model_selection import GridSearchCV

param_grid = {'C': [0.1, 1, 10], 'kernel': ['linear', 'rbf']}
grid_svm = GridSearchCV(SVC(), param_grid, cv=5)#t√¨m b·ªô tham s·ªë gi√∫p m√¥ h√¨nh c√≥ ƒë·ªô ch√≠nh x√°c cao nh·∫•t.
grid_svm.fit(X_train, y_train)

print("\n=== ‚öôÔ∏è TINH CH·ªàNH M√î H√åNH SVM ===")
print("Best Parameters:", grid_svm.best_params_)
print("Best CV Score:", round(grid_svm.best_score_, 4))

best_svm = grid_svm.best_estimator_  #l·∫•y m√¥ h√¨nh SVM ƒë√£ ƒë∆∞·ª£c hu·∫•n luy·ªán v·ªõi tham s·ªë t·ªëi ∆∞u.
y_pred_best = best_svm.predict(X_test) #d√πng m√¥ h√¨nh t·ªëi ∆∞u ƒë·ªÉ d·ª± ƒëo√°n nh√£n cho t·∫≠p ki·ªÉm tra

print("Final Accuracy (Optimized SVM):", round(accuracy_score(y_test, y_pred_best), 4))





















import matplotlib.pyplot as plt
import numpy as np
from ucimlrepo import fetch_ucirepo

# T·∫£i dataset
dataset = fetch_ucirepo(id=468)

X = dataset.data.features
y = dataset.data.targets

# ƒê·∫øm s·ªë l∆∞·ª£ng kh√°ch mua v√† kh√¥ng mua
counts = y['Revenue'].value_counts()
labels = counts.index.astype(str)
sizes = counts.values

# T·∫°o m√†u gi·ªëng m·∫´u
plt.style.use('_mpl-gallery-nogrid')
colors = plt.get_cmap('Blues')(np.linspace(0.3, 0.8, len(sizes)))

# V·∫Ω bi·ªÉu ƒë·ªì
fig, ax = plt.subplots(figsize=(6,6))

ax.pie(sizes, colors=colors, radius=3, center=(4, 4),
       wedgeprops={"linewidth": 1, "edgecolor": "white"}, 
       labels=labels, autopct='%1.1f%%', frame=True)

ax.set(xlim=(0, 8), xticks=np.arange(1, 8),
       ylim=(0, 8), yticks=np.arange(1, 8))

plt.title("T·ª∑ l·ªá kh√°ch h√†ng mua h√†ng (Revenue) trong dataset Online Shop")
plt.show()
